{% extends "base.html" %}
{% block content %}
<h2 class="text-primary mb-4">Make Picks for {{ current_round.name }}</h2>
<form method="POST" id="picksForm">
    {% if games %}
    <div class="table-responsive">
        <table class="table table-striped" id="picksTable">
            <thead class="table-dark">
                <tr>
                    <th>Team 1</th>
                    <th>Team 2</th>
                </tr>
            </thead>
            <tbody>
                {% for game in games %}
                <tr id="gameRow{{ game.id }}">
                    <td>
                        <div class="form-check" style="padding-left: 2.5rem;">
                            <input type="radio" class="form-check-input" name="game{{ game.id }}" value="{{ game.team1 }}"
                                id="game{{ game.id }}_team1"
                                {% if existing_picks[game.id] and existing_picks[game.id].picked_team == game.team1 %}checked{% endif %}
                                required>
                            <label class="form-check-label" for="game{{ game.id }}_team1">{{ game.team1 }}</label>
                        </div>
                    </td>
                    <td>
                        <div class="form-check" style="padding-left: 2.5rem;">
                            <input type="radio" class="form-check-input" name="game{{ game.id }}" value="{{ game.team2 }}"
                                id="game{{ game.id }}_team2"
                                {% if existing_picks[game.id] and existing_picks[game.id].picked_team == game.team2 %}checked{% endif %}
                                required>
                            <label class="form-check-label" for="game{{ game.id }}_team2">{{ game.team2 }}</label>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if current_round.name == 'Championship' %}
    <div class="mb-3">
        <label for="wager" class="form-label">Wager (Max: {{ current_user.points }})</label>
        <input type="number" class="form-control" id="wager" name="wager" min="0" max="{{ current_user.points }}"
            value="{% if existing_picks and existing_picks|length > 0 %}{{ existing_picks.values()|first.wager }}{% else %}0{% endif %}">
    </div>
    {% endif %}
    <button type="submit" class="btn btn-primary">Submit Picks</button>
    {% else %}
    <div class="alert alert-warning">No games available for this round yet.</div>
    {% endif %}
</form>

<script>
    document.getElementById('picksForm').addEventListener('submit', function(event) {
        let allSelected = true;
        {% for game in games %}
            const team1Checked = document.getElementById('game{{ game.id }}_team1').checked;
            const team2Checked = document.getElementById('game{{ game.id }}_team2').checked;
            const row = document.getElementById('gameRow{{ game.id }}');
            if (!team1Checked && !team2Checked) {
                allSelected = false;
                row.classList.add('table-danger');
            } else {
                row.classList.remove('table-danger');
            }
        {% endfor %}
        if (!allSelected) {
            event.preventDefault();
            flashMessage('Please select one team per game.', 'danger');
        }
    });

    function flashMessage(message, category) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${category} fade show`;
        alertDiv.role = 'alert';
        alertDiv.innerText = message;
        document.body.insertBefore(alertDiv, document.querySelector('.container'));
        setTimeout(() => alertDiv.remove(), 3000);
    }
</script>

<style>
    .form-check { padding: 10px 0; }
    .form-check:hover { background-color: #f0f0f0; }
    .table-danger { background-color: #f8d7da; }
</style>
{% endblock %}